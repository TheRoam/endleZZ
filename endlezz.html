<!--
----------------------------
Initial concept 23-Sep-2022
----------------------------
version 0.1 24-09-2022  Layout and basic functionalities
    changelog:
        - created player object centered on screen
        - created bottom menu for game info and controls
        - created intro loading screen that triggers full screen
        - created zombie objects that randomly spawn on borders
        - created zombie levels as bigger objects harder to defeat
        - created bullet object
        - bullet object moves to cursor click
        - created collision detector
        - collision removes zombie level objects
        - collision adds kill stats
        - collision updates text
        - collision with player ends the game
        - bottom stats show total zombies spawned
        - bottom stats show game time
        - bottom controls show Pause and Restore (not 100% working)
        - bottom controls show Gun Rate for adjustment
        - zombie object moves to player object using animation
        - zombie object removed after animation ends
----------------------
version 0.1.1 28-09-2022  Initial bugfix
    changelog:
        - disabled user-select so game text is now not selectable
        - adjusted warning size
        - created function to check origin and display warning accordingly
----------------------
version 0.2.0 23-09-2023  Anniversary update
    changelog:
        - added options menu
        - added timing controls: pause, restore, quit
        - graphics improvements: game objects
        - weather system: random cloud generation
        - added instructions page
        - bullets now reach the end of the screen despite where you click
        - overall performance improvements
----------------------
version 0.2.1 24-09-2023  minor styling
    changelog:
        - fixed menu background display
        - added zombie eyes
----------------------
-->
<html>
<meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    width:100vw;
    height:100vh;
    margin:0;
    background-color:black;
    overflow:hidden;
    cursor:context-menu;
    -webkit-user-select: none; /* Safari */
    -ms-user-select: none; /* IE 10 and IE 11 */
    user-select: none; /* Standard syntax */
}

#message{
    display:none;
    position:absolute;
    flex-direction:column;
    align-items:center;
    padding:50px 20px 50px 20px;
    width:100%;
    height:100%;
    background-color:rgba(0,0,0,0.98);
    z-Index:1001;
    overflow:auto;
}

input{
    height:0;
    margin:0;
    background:none;
    border:none;
}

.msgTxt{
    width:90%;
    background-color:rgba(255,255,255,0.05);
    font-size:24px;
    font-family:Verdana;
    color:white;
    padding:20px 10px 10px 10px;
    z-Index:1001;
    animation:msgTxt 1s linear;
}

.msgTit{
    width:90%;
    background-color:rgba(255,255,255,0.05);
    font-size:48px;
    font-weight:bold;
    text-align:center;
    font-family:Verdana;
    color:white;
    padding:20px 10px 10px 10px;
    z-Index:1001;
    animation:msgTxt 1s linear;
}

.aMsgTxt:hover{
    cursor:pointer;
    text-decoration:underline;
}

@keyframes msgIn{
    0%{top:-100%;}
    80%{top:20%;}
    100%{top:10%;}
}

@keyframes msgTxt{
    0%{opacity:0;}
    100%{opacity:1;}
}

#intro{
    padding:2vw 2vw 2vw 2vw;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    position:absolute;
    top:0;
    left:0;
    background-color:black;
    width:100vw;
    height:100vh;
    color:white;
    font-family:times new roman;
    font-weight:bold;
    font-size:20vw;
    font-style:oblique;
    font-variant:small-caps;
    z-Index:1000;
    perspective:80vw;
    overflow:hidden;
}

#introTit{
    transform:rotateY(-45deg) rotateX(15deg) translateX(-10vw);
    text-shadow:0.8vw -0.05vw 0.1vw darkgrey;
}

#TRW{
    color:orangered;
    text-decoration:none;
}

#TRW:hover{
    color:darkorange;
}

#stBtn{
    color:darkred;
    background:transparent;
    border:none;
    font-family:times new roman;
    font-variant:small-caps;
    font-size:10vw;
    text-shadow:2px 2px 2px darkslategrey;
    text-decoration:underline;
    animation:start 1.5s infinite;
}
#stBtn:hover{
    color:white;
}
@keyframes start{
    from {color:rgba(255, 160, 122,255);}
    to {color: rgba(178, 34, 34,255);}
}

#main{
    width:100vw;
    height:100vh;
    top:0;
    background-color: MediumAquaMarine;
    background: radial-gradient(peru 0%, saddlebrown 100%);
    overflow:hidden;
    z-Index:1;
}

#objs{
    width:100vw;
    height:100vh;
    position:absolute;
    top:0;
    overflow:hidden;
}
#sky{
    width:100vw;
    height:100vh;
    position:absolute;
    top:0;
    overflow:hidden;
    z-Index:99;
}

:fullscreen {
  background-color: MediumAquaMarine;
  background: radial-gradient(peru 0%, saddlebrown 100%);
}

:-webkit-full-screen {
  background-color: MediumAquaMarine;
  background: radial-gradient(peru 0%, saddlebrown 100%);
}

#plyr-cnt{
    position:absolute;
    width:1px;
    height:1px;
    z-Index:10;
}
#plyr-bdy{
    display:block;
    left:8px;
    top:8px;
    background-color:black;
    z-Index:10;
}
#plyr-gun-cnt{
    display:block;
    position:relative;
    width:1px;
    height:1px;
    top:50%;
    left:50%;
    background-color:black;
    transform:rotate(45deg);
    z-Index:10;
}

#plyr-gun{
    display:block;
    position:relative;
    width:4px;
    height:20px;
    top:3px;
    left:-1px;
    background-color:lightgrey;
    z-Index:10;
}

#btmMenu{
    display:flex;
    flex-direction:column;
    position:absolute;
    bottom:0;
    left:0;
    width:100vw;
    text-align:center;
    z-Index:100;
}

.statBar{
    width:100vw;
    border:2px solid black;
    background-color:lightgrey;
    font-family:Verdana;
    font-size:24px;
    font-variant:small-caps;
    align-content:center;
    align-items:center;
    padding: 5px 5px 5px 5px;
}

#optBar{
    display:flex;
    position:absolute;
    top:0;
    right:0;
    flex-direction:column;
    text-align:center;
    z-Index:100;
}

.optBtn{
    width:50px;
	height:50px;
	vertical-align:middle;
    font-size:30px;
    background-color:none;
    margin:0;
    padding:0;
    cursor:pointer;
    color:white;
    text-shadow:1px 0 1px white;
    visibility:visible;
}

.optBtn:hover{
    color:darkorange;
}

#gameTxt{
    display:block;
    position:absolute;
    top:10%;
    width:100%;
    height:50px;
    margin:auto;
    opacity:0;
    z-Index:100;
}

.gameTxt{
    display:block;
    position:absolute;
    top:10%;
    width:100%;
    height:50px;
    font-size:32px;
    font-weight:bold;
    font-family:Verdana;
    margin:auto;
    color:LemonChiffon;
    opacity:0;
    z-Index:20;
    text-shadow:2px 0 2px DarkRed;
    text-align:center;
    z-Index:100;
    cursor:context-menu;
    animation: fadeTxt 3s linear;
}

#gRate{
    width:50px;
    font-size:18px;
}

.blood{
    background-color:FireBrick;
    opacity:75%;
}

@keyframes fadeTxt{
    0% {opacity:1;}
    100% {opacity:0;transform:translateY(-50px);}
}

@keyframes cMoveA{
    0% {opacity:0;}
    50% {opacity:0.8;}
    100% {opacity:0;transform:translate(0px,0px);}
}

@keyframes cMoveB{
    0% {opacity:0;}
    50% {opacity:0.8;}
    100% {opacity:0;transform:translate(0px,0px);}
}

@keyframes zMove{
    100% {left:50%;top:50%;}
}

@keyframes died{
    0% {top:50%;left:50%}
    25% {top:50.25%;left:50.25%}
    50% {top:49.75%;left:50.25%}
    75% {top:50.25%;left:49.75%}
    100%{top:49.75%;left:49.75%}
}

@keyframes eat{
    0% {top:50.25%;left:49.75%}
    25% {top:49.75%;left:50.25%}
    50% {top:49.75%;left:49.75%}
    75% {top:50.25%;left:50.25%}
    100%{top:50.25%;left:49.75%}
}

@keyframes blood{
    100%{width:100px;height:100px;border-radius:100px;}
}

.paused{
    -webkit-animation-play-state:paused;
    -moz-animation-play-state:paused;
    -o-animation-play-state:paused; 
    animation-play-state:paused;
}
.optBarFill{
    background-color:lightgrey;
}

</style>
<body>
<!-- Warning message -->
<div id="message">
    <!--<span style="font-size:48px;font-weight:bold;text-align:center;" class="msgTxt"><span style="color:yellow;">☢</span>  WARNING!</span>
    <span class="msgTxt">Make sure that this copy is downloaded from the official source @github:<br><br><a style="color:orangered" href="" target="_blank">https://github.com/TheRoam/endleZZ</a><br><br>This game contains javascript code that could be edited and redistributed for malicious purposes.<br><br>You can check the original code at github and read the blog for a detailed explanation of the game functions and design.</span>

    <input name="instructions"/>
    <label for="intrsuctions" style="font-size:48px;font-weight:bold;color:darkgrey;" class="msgTxt">▶ INSTRUCTIONS</label>
    <input name="skip"/>
    <label for="skip" style="font-size:48px;font-weight:bold;color:orangered;" class="msgTxt aMsgTxt" onclick="clsWrn()">▶ SKIP</label>
-->
</div>


<!-- Intro screen. Waits for everything to load then launches fullscreen when player is ready -->
<div id="intro">

<!-- The Roaming Workshop header and hyperlink -->
    <span style="color:orangered;transform:rotateY(-45deg) rotateX(20deg) rotateZ(1deg) translateX(-10vw);padding:0;margin-bottom:-5vw;text-shadow:0.3vw 0.05vw 0.02vw darkred;font-family:courier new;font-size:4vw;font-style:normal;font-variant:small-caps;"><a id="TRW" href="https://theroamingworkshop.cloud" target="_blank">TheRoamingWorkshop</a><br><span style="font-size:3vw;color:white;text-shadow:0.3vw 0.05vw 0.02vw darkgrey;font-variant:none;">brings you...</span></span>

<!-- Game title -->
    <span id="introTit">endleZZ<br>

<!-- Game description -->
    <span style="text-align:right;font-size:4vw;font-variant:normal;transform:rotateZ(-3deg);text-shadow:0.3vw 0.05vw 0.02vw darkgrey;">A <span style="color:darkgrey;text-decoration:line-through;text-decoration-thickness:0.5vw;">silly</span> tiny <span style="font-family:courier new;font-size:4vw;font-style:normal;">&#60javascript&#62</span> infinite zombie game<i style="color:orangered"><br>v 0 . 2 . 1</i></span>
    </span>

<!-- Start button -->
    <button id="stBtn" onclick="start()" ontouchstart="start()" onmousedown="start()">start</button>
</div>

<!-- Main game screen -->
<span id="gameTxt" class="gameTxt">GO!</span>
<div id="main">
    <div id="plyr-cnt">
        <div id="plyr-bdy">
            <div id="plyr-gun-cnt">
                <div id="plyr-gun"></div>
            </div>
        </div>
    </div>
</div>

<div id="objs"></div>
<div id="sky"></div>

<!-- Options icons -->
<!--Disabled for the moment-->
<div id="optBar">
    <span id="menuBtn" class="optBtn" ontouchstart="toggleMenu()" onmousedown="toggleMenu()"><b>⚙</b></span><br>
    <span id="pauseBtn" class="optBtn" style="font-size:20px;" ontouchstart="pause()" onmousedown="pause()">▮▮</span><br>
    <span id="rstBtn" class="optBtn" ontouchstart="restore()" onmousedown="restore()"><b>↺</b></span><br>
    <span id="exitBtn" class="optBtn" ontouchstart="exit()" onmousedown="exit()"><b>↩</b></span><br>
</div>


<!-- Bottom control menu -->
<div id="btmMenu">

<!-- Stats bar -->
<span class="statBar">Time <span id="tStat">0 : 0 : 0</span><span id="zStat"> | Hits: 0 | Kills: 0 | Spawns: 0 | Bullets: 0</span><span id="sStat"> | Score: 0</span></span>

</div>

</body>
<script>

//Check app execution location
iniWarning();

//Function to display a full screen message
function msg(tit,txt){
    //display message box
    var msg=document.getElementById("message");
    msg.style.animation="msgIn 0.5s linear";
    msg.style.display="flex";
    //set title
    var msgTit=document.createElement("span");
    msgTit.setAttribute("id", "msgT");
    msgTit.setAttribute("class", "msgTit");
    msg.appendChild(msgTit);
    msgTit=document.getElementById("msgT");
    msgTit.innerHTML=tit;
    //set text
    var msgTxt=document.createElement("span");
    msgTxt.setAttribute("id", "msgt");
    msgTxt.setAttribute("class", "msgTxt");
    msg.appendChild(msgTxt);
    msgTxt=document.getElementById("msgt");
    msgTxt.innerHTML=txt;
}

//Function to check local execution
function checkOrigin(){
    //get app execution location
    var appE=window.location.href;
    var appO="https://theroamingworkshop.cloud/endlezz/";
    if(appO==appE){
        return("TRW");
    }else{
        return("OTHER");
    }
}

//Function to dispaly initial warning
function iniWarning(){
    var chk=checkOrigin();
    console.log(chk);
    if(chk=="TRW"){
    msg(
"<span style='color:SpringGreen;'>☑</span>  WELCOME!"
    ,
"You are playing an official web version of <b>endleZZ</b>. ENJOY!<br><br>\
<br><br><input name='instructions'/>\
<label for='intrsuctions' style='font-size:48px;font-weight:bold;color:darkgrey;'>▶ INSTRUCTIONS</label>\
<br><br><button style='font-size:48px;font-weight:bold;color:orangered;' class='aMsgTxt' onclick='clsMsg()'>▶ SKIP</button>"

    );
    }else{
    msg(
"<span style='color:yellow;'>☢</span>  WARNING!"
    ,
"You are playing local version of <b>endleZZ</b>.<br><br>\
Make sure that this copy is downloaded from the official source @github:<br><br>\
<a style='color:orangered' href='https://github.com/TheRoam/endleZZ' target='_blank'>https://github.com/TheRoam/endleZZ</a>\
<br><br>This game contains javascript code that could be edited and redistributed for malicious purposes.\
<br><br>Otherwise, you can play an official web version in:\
<br><br><a style='color:orangered' href='https://theroamingworkshop.cloud/endleZZ' target='_blank'>https://theroamingworkshop.cloud/endleZZ</a>\
<br><br><input name='instructions'/>\
<label for='intrsuctions' style='font-size:48px;font-weight:bold;color:darkgrey;'>▶ INSTRUCTIONS</label>\
<br><br><input type='button' name='skip'/>\
<br><br><button style='font-size:48px;font-weight:bold;color:orangered;' class='aMsgTxt' onclick='clsMsg()'>▶ SKIP</button>"
    );
    }
}

//Game variables
var ang=0;                      //cursor angle
var AngleStatus=1;              //angle status, freezed or responsive
var z=0;                        //zombie counter
var b=0;                        //bullet counter
var k=0;                        //kill counter
var H=0;                        //hit counter
var S=0;                        //score
var N=1;
var w=window.innerWidth;        //screen width
var h=window.innerHeight;       //screen height
var maxTspawn=5000;             //maximum spawn time
var tSpawn=Math.random()*maxTspawn+1;  //random spawn time in miliseconds from 0 to maxTspawn
var tIni=new Date();            //initial time variable
var gameClone="";
var maxTrees=30;				//maximum number of trees to spawn
var treeId=0;					//tree counter
var treeOffset=200;				//tree offset distance from center in pixels
var maxRocks=80;				//maximum number of rocks to spawn
var rockId=0;					//rock counter
var maxClouds=50;				//maximum number of clouds to spawn
var cloudId=0;					//cloud counter
var cRateA=11;					//cloud rate in seconds for animation
var cRateB=27;					//cloud rate in seconds for animation
var cAnim=[];

var sMin=5;                     //minimum speed (in seconds)
var sMax=20;                    //maximum speed (in seconds)
var lMin=1;                     //minimum level (cubes that make up the zombie)
var lMax=4;                     //maximum level (maximum cubes forming the side of the zombie)
var pX="50%";                   //player X coordinate
var pY="50%";                   //player Y coordinate
var pW=15;                      //player Width in pixels
var pH=15;                      //player Height in pixels
var gRate=2;                    //gun shooting rate
var refRate=3000;               //gun rate reference value in miliseconds

var time="";
var zSpawn="";
var screenCheck="";
var colDetect="";
var tAtPause=0;
var tRestore=0;
var tTime;
var shot="";
var gameStatus="";


//Function at game start
function start(){
	//Remove intro menu and set to full screen
    document.getElementById("intro").style.display="none";
    window.document.body.requestFullscreen();
    //hide options
    hideMenu();
    
    //Set game status to "Playing"
    gameStatus="Playing";
    
    //set listeners
    addListeners();
    
    //spawn objects
		//spawn trees
    var treeNum=Math.random()*maxTrees+1;
    for (var t=0;t<treeNum;t++){
		//console.log("Spawning tree "+t);
		spawnTrees();
	}
		//spawn rocks
    var rockNum=Math.random()*maxRocks+1;
    for (var r=0;r<rockNum;r++){
		//console.log("Spawning rock "+r);
		spawnRocks();
	}
	
    //place player
    plyrPos();
    //clone game for restart
    gameClone=document.body.cloneNode(true);

	//spawn first clouds
	spawnCloudsA();
	//loop for cloud spawn
    cSpawnA=setInterval(spawnCloudsA,cRateA*1000);
    cSpawnB=setInterval(spawnCloudsB,cRateB*1000);
    
    //loop for timer
    tIni=new Date();
    //start with 1s delay to avoid counting first click
    setTimeout(function(){
        time=setInterval(timer,100);
        b=0;
        S=0;
    },1000);
    
    //loop for zombie spawn
    zSpawn=setTimeout(zObject,tSpawn);
    
    //loop to check screen size and recalculate new locations
    screenCheck=setInterval(screen,1000);
    
    //loop for collision detector
    colDetect=setInterval(colDetector,10);
}

//Function for restart
function restart(){
    //remove current body
    document.body.innerHTML="";
    //add start body
    document.body.innerHTML=gameClone.innerHTML;
    
    //restore game status to "playing"
    gameStatus="Playing";
    
    //restore objects
    document.getElementById("objs").innerHTML="";
		//spawn trees
    var treeNum=Math.random()*maxTrees+1;
    for (var t=0;t<treeNum;t++){
		//console.log("Spawning tree "+t);
		spawnTrees();
	}
		//spawn rocks
    var rockNum=Math.random()*maxRocks+1;
    for (var r=0;r<rockNum;r++){
		//console.log("Spawning rock "+r);
		spawnRocks();
	}
	
	//spawn first clouds
	spawnCloudsA();
	//loop for cloud spawn
    cSpawnA=setInterval(spawnCloudsA,cRateA*1000);
    cSpawnB=setInterval(spawnCloudsB,cRateB*1000);
	
    //continue startup
    //loop for timer
    tIni=new Date();
    time=setInterval(timer,100);
    //loop for spawn
    zSpawn=setTimeout(zObject,tSpawn);
    //loop to check screen size adn recalculate new locations
    screenCheck=setInterval(screen,1000);
    //loop for collision detector
    colDetect=setInterval(colDetector,10);
    //reset scores
    k=0;
    H=0;
    b=0;
    S=0;
    z=0;
}

//Function for pause
function pause(){
    if(gameStatus=="Playing"){
    //save time
    tAtPause=new Date(tTime);
    
    //Set game status to "Paused"
    gameStatus="Paused";
    
    //kill all timer intervals
    clearInterval(time);
    clearTimeout(zSpawn);
    clearInterval(screenCheck);
    clearInterval(colDetect);
    clearInterval(cSpawnA);
    clearInterval(cSpawnB);
    //stop animations
    stopAnimations();
    //stop listeners
    //NOT USED - BUGGY!!
    //stopListeners();
    //notify pause
    notify("GAME PAUSED!");
    }
}

//Function for end
function end(){
    if(gameStatus=="Playing"){
    //Set game status to "Paused"
    gameStatus="Ended";
    
    //kill all timer intervals
    clearInterval(time);
    clearTimeout(zSpawn);
    clearInterval(screenCheck);
    clearInterval(colDetect);
    clearInterval(cSpawnA);
    clearInterval(cSpawnB);
    //end animation
    endAnimation();
    //stop listeners
    //NOT USED - BUGGY!!
    //stopListeners();
    }
}

//Function to restore after pause
function restore(){
    if(gameStatus=="Paused"){
        gameStatus="Playing";
        //restore time counter
        //tRestore=new Date(tTime);
        tIni=new Date();
        time=setInterval(timer,1000);
        //loop for spawn
        zSpawn=setTimeout(zObject,tSpawn);
        //loop to check screen size adn recalculate new locations
        screenCheck=setInterval(screen,1000);
        //loop for collision detector
        colDetect=setInterval(colDetector,10);
	    //loop for cloud spawn
        cSpawnA=setInterval(spawnCloudsA,cRateA*1000);
        cSpawnB=setInterval(spawnCloudsB,cRateB*1000);
        //restore animations
        restoreAnimations();
        //restore listeners
        addListeners();//TO-DO: doesnt restore listeners!!!
        //notify restore
        notify("GAME RESTORED!");
    }
}

//Function to exit game and go back to initial screen
function exit(){
    //Restore initial screen
    document.getElementById("intro").style.display="flex";
    window.document.exitFullscreen();
    //refresh page
    window.location.reload();
}

//Timer function
function timer(){
    var tNow=new Date();
    tTime=new Date(tNow-tIni);
    try{
        tTime.setTime(tTime.getTime()+tAtPause.getTime());
    }catch(err){//avoids error when tAtPause is cero
    }

    //update time    
    document.getElementById("tStat").innerHTML=timeFormat(tTime.getUTCHours())+" :"+timeFormat(tTime.getUTCMinutes())+" :"+timeFormat(tTime.getUTCSeconds());

    //update stats
    var L=document.getElementById("main").children.length-1;
    S=H-b+(k*10);
    document.getElementById("zStat").innerHTML=" | Hits: "+H+" | Kills: "+k+" | Spawns: "+z+" | Bullets: "+b;
    document.getElementById("sStat").innerHTML=" | Score: "+S;
}

//Function to format time when it's only one digit
function timeFormat(t){
    if(t<10){
        t=" "+t;
        return t;
    }else{
        return t;
    }
}

//Function to check screen size
function screen(){
    w=window.innerWidth;
    h=window.innerHeight;
}

//Function to spawn trees randomly at start
function spawnTrees(){

    //create object for tree
    var tree=document.createElement("span");
    //assign ID (ascending) used as counter
    treeId++;
    tree.setAttribute("id","tree"+treeId);
    
    //set tree type (number of circles that make up the tree, random from 1 to 5)
    var tLvl=Math.floor((Math.random()*(5-1+1))+1);
    tree.setAttribute("lvl",tLvl);
    //add to game
    document.getElementById("objs").appendChild(tree);

    //reassign tree object for edition
    tree=document.getElementById("tree"+treeId);
    
    //ubicación aleatoria
    //la ubicación es porcentual para conservarla al redimensionar
    //se excluye el centro de la pantalla para no tapar al jugador

	var zX=Math.random()*(w-1); //excluimos el último pixel para que no quede fuera
	var zY=Math.random()*(h-1);
	while ( ( zX>(w/2-treeOffset) && zX < (w/2+treeOffset) ) || ( zY>(h/2-treeOffset) && zY < (h/2+treeOffset) ) ){
		zX=Math.random()*(w-1);
		zY=Math.random()*(h-1);
	}
	
	tree.style.left=((Math.random() * 5)+(zX*100/w))+"%";
	tree.style.top=((Math.random() * 5)+(zY*100/h))+"%";

    //add object levels if needed
    //first, get total cubes needed for object level
    var lTotal=tLvl**2;
    if(tLvl>1){
        //loop for rows
        for (var i=-1;i<tLvl-1;i++){
            //loop for columns
            var j=-1;
            /*if(i==0){
                j=1;
            }*/
            for(j;j<tLvl-1;j++){
                var lvl=tree.cloneNode();
                lvl.setAttribute("id","t"+treeId+"."+i+"."+j);
                tree.appendChild(lvl);
                //set properties
                lvl=document.getElementById("t"+treeId+"."+i+"."+j);
                //move to right (offset from left origin)
                //lvl.style.left=(j*8)+"px";
                //move each row
                //lvl.style.top=(i*8)+"px";
                //place randomly
                lvl.style.left=((Math.random() * 10)+(zX*100/w))+"%";
				lvl.style.top=((Math.random() * 10)+(zY*100/h))+"%";
				//size random from 5 to 100 px
				var treesize=Math.floor((Math.random()*100)+5)+"px";
				lvl.style.width=treesize;
				lvl.style.height=treesize;
				lvl.style.backgroundColor="DarkGreen";
				lvl.style.backgroundImage="radial-gradient(Maroon 5%, DarkGreen 6%, DarkGreen 60%)";
				lvl.style.position="absolute";
				lvl.style.zIndex="50";
				lvl.style.opacity=0.4;
				lvl.style.borderRadius=treesize;
				lvl.style.border="2px solid DarkGreen";
				lvl.style.boxShadow="0 0 20px DarkOliveGreen";
            }
        }
    }
	
}

//Function to spawn rocks randomly at start
function spawnRocks(){

    //create object for rock
    var rock=document.createElement("span");
    //assign ID (ascending) used as counter
    rockId++;
    rock.setAttribute("id","rock"+rockId);
    
    //set rock type (number of circles that make up the rock, random from 1 to 3)
    var rLvl=Math.floor((Math.random()*(3-1+1))+1);
    rock.setAttribute("lvl",rLvl);
    //add to game
    document.getElementById("objs").appendChild(rock);

    //reassign rock object for edition
    rock=document.getElementById("rock"+rockId);
    
    //ubicación aleatoria
    //la ubicación es porcentual para conservarla al redimensionar

	var zX=Math.random()*(w-1); //excluimos el último pixel para que no quede fuera
	var zY=Math.random()*(h-1);
	
	rock.style.left=((Math.random() )+(zX*100/w))+"%";
	rock.style.top=((Math.random() )+(zY*100/h))+"%";

    //add object levels
    //first, get total cubes needed for object level
    var lTotal=rLvl**2;
    if(rLvl>1){
        //loop for rows
        for (var i=-1;i<rLvl-1;i++){
            //loop for columns
            var j=-1;
            /*if(i==0){
                j=1;
            }*/
            for(j;j<rLvl-1;j++){
                var lvl=rock.cloneNode();
                lvl.setAttribute("id","r"+rockId+"."+i+"."+j);
                rock.appendChild(lvl);
                //set properties
                lvl=document.getElementById("r"+rockId+"."+i+"."+j);
                //place randomly
                lvl.style.left=((Math.random() )+(zX*100/w))+"%";
				lvl.style.top=((Math.random() )+(zY*100/h))+"%";
				//size random from 5 to 20 px
				var rocksize=Math.floor((Math.random()*20)+5)+"px";
				lvl.style.width=rocksize;
				lvl.style.backgroundColor="DarkSlateGrey";
				lvl.style.position="absolute";
				lvl.style.zIndex="1";
				lvl.style.opacity=0.85;
				lvl.style.borderRadius=rocksize;
				lvl.style.border="1px solid DarkSlateGrey";
				lvl.style.boxShadow="0 0 3px rgba(0,0,0,0.8)";
				lvl.style.height=parseFloat(rocksize.substring(0,rocksize.length-2))*0.65+"px";
            }
        }
    }

}

//Function to randomly add clouds
function spawnCloudsA(){

    //create object for clouds
    var cloud=document.createElement("span");
    //assign ID (ascending) used as counter
    cloudId++;
    cloud.setAttribute("id","cloud"+cloudId);
    
    //set cloud type (number of circles that make up the cloud, random from 3 to 10)
    var cLvl=Math.floor((Math.random()*(10-1+3))+3);
    cloud.setAttribute("lvl",cLvl);
    //add to game
    document.getElementById("sky").appendChild(cloud);

    //reassign cloud object for edition
    cloud=document.getElementById("cloud"+cloudId);
    
    //ubicación aleatoria
    //la ubicación es porcentual para conservarla al redimensionar

	var zX=Math.random()*(w-1); //excluimos el último pixel para que no quede fuera
	var zY=Math.random()*(h-1);
	
	cloud.style.left=((Math.random() )+(zX*100/w))+"%";
	cloud.style.top=((Math.random() )+(zY*100/h))+"%";
	cloud.style.zIndex=95;

    //add object levels
    //first, get total cubes needed for object level
    var lTotal=cLvl**2;
    var plusOrMinus = Math.random() < 0.5 ? -1 : 1;
    if(cLvl>1){
        //loop for rows
        for (var i=1;i<=cLvl;i++){
            //loop for columns
            var j=1;
            /*if(i==0){
                j=1;
            }*/
            //for(j;j<=cLvl;j++){
                var lvl=cloud.cloneNode();
                lvl.setAttribute("id","c"+cloudId+i);
                cloud.appendChild(lvl);
                //set properties
                lvl=document.getElementById("c"+cloudId+i);
                //place randomly
                lvl.style.left=((Math.random() )+(zX*100/w))*0.1*plusOrMinus+"%";
                plusOrMinus = Math.random() < 0.5 ? -1 : 1;
				lvl.style.top=((Math.random() )+(zY*100/h))*0.1*plusOrMinus+"%";
				//size random from 20 to 500 px
				var cloudsize=Math.floor((Math.random()*500)+20)+"px";
				lvl.style.width=cloudsize;
				lvl.style.backgroundColor="WhiteSmoke";
				lvl.style.position="absolute";
				lvl.style.zIndex="95";
				lvl.style.opacity=0;
				lvl.style.borderRadius=cloudsize;
				lvl.style.border="1px solid White";
				lvl.style.boxShadow="0 0 3px Snow";
				lvl.style.height=parseFloat(cloudsize.substring(0,cloudsize.length-2))*Math.random()*0.5+"px";
				//add cloud animation
				lvl.style.animation="cMoveA "+cRateA+"s ease-in-out";
				//modify coordinates
				
	            plusOrMinus = Math.random() < 0.5 ? -1 : 1;
                zX=Math.random()*(w-1)*plusOrMinus;
                
                plusOrMinus = Math.random() < 0.5 ? -1 : 1;
            	zY=Math.random()*(h-1)*plusOrMinus;
				
				document.styleSheets[0].rules[32][2].style.setProperty("transform","translate("+zX+w+"px,+"+zY+h+"px)")
				
			    //remove cloud after animation
                lvl.addEventListener("animationend", function(){
                    objClear(lvl.id);
                }); 
                //for chrome, safari, opera..
                lvl.addEventListener("webkitAnimationEnd", function(){
                    objClear(lvl.id);
                });
        }
    }
}
function spawnCloudsB(){

    //create object for clouds
    var cloud=document.createElement("span");
    //assign ID (ascending) used as counter
    cloudId++;
    cloud.setAttribute("id","cloud"+cloudId);
    
    //set cloud type (number of circles that make up the cloud, random from 3 to 10)
    var cLvl=Math.floor((Math.random()*(10-1+3))+3);
    cloud.setAttribute("lvl",cLvl);
    //add to game
    document.getElementById("sky").appendChild(cloud);

    //reassign cloud object for edition
    cloud=document.getElementById("cloud"+cloudId);
    
    //ubicación aleatoria
    //la ubicación es porcentual para conservarla al redimensionar

	var zX=Math.random()*(w-1); //excluimos el último pixel para que no quede fuera
	var zY=Math.random()*(h-1);
	
	cloud.style.left=((Math.random() )+(zX*100/w))+"%";
	cloud.style.top=((Math.random() )+(zY*100/h))+"%";
	cloud.style.zIndex=95;

    //add object levels
    //first, get total cubes needed for object level
    var lTotal=cLvl**2;
    var plusOrMinus = Math.random() < 0.5 ? -1 : 1;
    if(cLvl>1){
        //loop for rows
        for (var i=1;i<=cLvl;i++){
            //loop for columns
            var j=1;
            /*if(i==0){
                j=1;
            }*/
            //for(j;j<=cLvl;j++){
                var lvl=cloud.cloneNode();
                lvl.setAttribute("id","c"+cloudId+i);
                cloud.appendChild(lvl);
                //set properties
                lvl=document.getElementById("c"+cloudId+i);
                //place randomly
                lvl.style.left=((Math.random() )+(zX*100/w))*0.1*plusOrMinus+"%";
                plusOrMinus = Math.random() < 0.5 ? -1 : 1;
				lvl.style.top=((Math.random() )+(zY*100/h))*0.1*plusOrMinus+"%";
				//size random from 20 to 500 px
				var cloudsize=Math.floor((Math.random()*500)+20)+"px";
				lvl.style.width=cloudsize;
				lvl.style.backgroundColor="WhiteSmoke";
				lvl.style.position="absolute";
				lvl.style.zIndex="95";
				lvl.style.opacity=0;
				lvl.style.borderRadius=cloudsize;
				lvl.style.border="1px solid White";
				lvl.style.boxShadow="0 0 3px Snow";
				lvl.style.height=parseFloat(cloudsize.substring(0,cloudsize.length-2))*Math.random()*0.5+"px";
				//add cloud animation
				lvl.style.animation="cMoveB "+cRateB+"s ease-in-out";
				//modify coordinates
				
	            plusOrMinus = Math.random() < 0.5 ? -1 : 1;
                zX=Math.random()*(w-1)*plusOrMinus;
                
                plusOrMinus = Math.random() < 0.5 ? -1 : 1;
            	zY=Math.random()*(h-1)*plusOrMinus;
				
				document.styleSheets[0].rules[33][2].style.setProperty("transform","translate("+zX+"px,+"+zY+"px)");
		
			    //remove cloud after animation
                lvl.addEventListener("animationend", function(){
                    objClear(lvl.id);
                }); 
                //for chrome, safari, opera..
                lvl.addEventListener("webkitAnimationEnd", function(){
                    objClear(lvl.id);
                });
        }
    }
}

//Function to place player in the center
function plyrPos(){
    //set player size and shape
    plyr=document.getElementById("plyr-bdy");
    plyr.style.width=pW+"px";
    plyr.style.height=pH+"px";
    plyr.style.borderRadius=(pW/2)+"px";

    //set to middle of screen
    var plyr=document.getElementById("plyr-cnt");
    plyr.style.left=(w/2-(pW/2))/w*100+"%";
    plyr.style.top=(h/2-(pH/2))/h*100+"%";
    //save in variables
    pX=plyr.style.left;
    pY=plyr.style.top;
}

//Function to set listeners for mouse or touch
function addListeners(){
        //touch
    document.body.addEventListener("touchmove", function(event){
        plyrAng(event);
    });
        //start shooting
    document.body.addEventListener("touchstart", function(event){
		//equivalent to mousedown except on Safari... it gets duplicated elsewhere
		//make an exception
    });
        //end shooting
    document.body.addEventListener("touchend", function(event){
        clearInterval(shot);
    });

        //mouse
    document.body.addEventListener("mousemove", function(event){
        plyrAng(event);
    });
        //start shooting
    document.body.addEventListener("mousedown", function(event){
        bulletAng(event);
        return true;
    });
}

//Function to stop listeners
function stopListeners(){
    //OPTION 1: clone body. Need to restore some listeners
    /*var bClone = document.body.cloneNode(true);

	document.body.parentNode.replaceChild(bClone, document.body);*/
	
	//OPTION 2: remove individual listeners. It wont restore them later.
    /*document.body.addEventListener("touchmove", function(event) {;
        event.stopImmediatePropagation();
    }, true);

    document.body.addEventListener("touchstart", function(event) {
        event.stopImmediatePropagation();
    }, true);

    document.body.addEventListener("touchend", function(event) {
        event.stopImmediatePropagation();
    }, true);

    document.body.addEventListener("mousemove", function(event) {
        event.stopImmediatePropagation();
    }, true);

    document.body.addEventListener("mousedown", function(event) {
        event.stopImmediatePropagation();
    }, true);*/
}

//Function to assign player rotation
function setRot(a){
    if(AngleStatus==1){
        document.getElementById("plyr-gun-cnt").style.transform="rotate("+(a-Math.PI/2)+"rad)";
    }
}
 
//Function to calculate player rotation angle
function plyrAng(e){

	//refresh screen size
	screen();
	
    //get touch/click coordinates

    try{//for touch
        var X=e.touches[0].clientX.toFixed(0);
        var Y=e.touches[0].clientY.toFixed(0);
    }catch{//on error, it's mouse
        var X=e.clientX.toFixed(0);
        var Y=e.clientY.toFixed(0);
    }

    //Calculate angle in radians (arc tangent of sides from center)
    if(X>=w/2){
        var a=X-(w/2);
        var b=Y-(h/2);
        ang=Math.atan((b/a)).toFixed(3);
    }else{
        var a=X-(w/2);
        var b=Y-(h/2);
        ang=(Math.PI+Math.atan((b/a))).toFixed(3);
    }

    //var t=document.getElementById("txt");
    //console.log(w+"w\n"+h+"h\n"+X+"X\n"+Y+"Y\n"+ang+"rad");

    //assign rotation to player
    setRot(ang);
}

//Function for bullet direction and animation
function bulletAng(e){
	//Only when gameStatus is "Playing"
	if(gameStatus!="Playing"){
		return;
	}
    var bAng=0;
    //get gun object
    var pGun=document.getElementById("plyr-bdy");

    //get touch/click coordinates
    try{//for touch
        var bX=e.touches[0].clientX.toFixed(0);
        var bY=e.touches[0].clientY.toFixed(0);
    }catch{//on error, it's mouse
        var bX=e.clientX.toFixed(0);
        var bY=e.clientY.toFixed(0);
    }
	
    //Calculate angle in radians (arc tangent of sides from center)
    if(bX>=w/2){
        var ba=bX-(w/2);
        var bb=bY-(h/2);
        bAng=Math.atan((bb/ba)).toFixed(3);
    }else{
        var ba=bX-(w/2);
        var bb=bY-(h/2);
        bAng=(Math.PI+Math.atan((bb/ba))).toFixed(3);
    }
    
    //Get diagonal angle
    var diagAng=Math.atan((h/2)/(w/2));
    
    //now get the distances to the borders using proportions depending on polar sectors
    //	ba/bb = bW/bH
	
	if(bAng>-diagAng && bAng < diagAng){
		//console.log("Sector1");
		var bW=w/2;
		bb=bW*bb/ba;
		ba=bW;
	}
	if( bAng>diagAng && bAng < (-diagAng+Math.PI) ){
		//console.log("Sector2");
		var bH=h/2;
		ba=ba*bH/bb;
		bb=bH;
	}
	if( bAng> (-diagAng+Math.PI) && bAng < (diagAng+Math.PI) ){
		//console.log("Sector3");
		var bW=w/2;
		bb=-bW*bb/ba;
		ba=-bW;
	}
	if( bAng> (diagAng+Math.PI) || bAng < -diagAng ){
		//console.log("Sector4");
		var bH=h/2;
		ba=-ba*bH/bb;
		bb=-bH;
	}

    //create bullet object
    b++;
    var bllt=document.createElement("span");
    //define ID for bullet
    bllt.setAttribute("id", "b"+b);
    //add to player
    pGun.appendChild(bllt);
    //redefine reference to bullet
    bllt=document.getElementById("b"+b);
    //define properties
    bllt.style.display="block";
    bllt.style.position="absolute";
    bllt.style.width="2px";
    bllt.style.height="2px";
    bllt.style.top=(pW/2)+"px";
    bllt.style.left=(pW/2)+"px";
    bllt.style.zIndex="10";
    bllt.style.backgroundColor="LemonChiffon";
//    bllt.style.transform="rotate("+(bAng-Math.PI/2)+"rad)";

    //add bullet animation
    var bStyle = document.createElement('style');
    bStyle.type = 'text/css';
    var bKF = '\
    @keyframes b'+b+' {\
        100% {\
            transform: translate('+ba+'px,'+bb+'px);\
        }\
    }\
    @-moz-keyframes b'+b+' {\
        100% {\
            -moz-transform: translate('+ba+'px,'+bb+'px);\
        }\
    }';
//    style.innerHTML = keyFrames.replace(/A_DYNAMIC_VALUE/g, "180deg");
    bStyle.innerHTML=bKF;
    bStyle.id="bS"+b;
    document.getElementsByTagName('head')[0].appendChild(bStyle);

    bllt.style.animation="b"+b+" "+(refRate/1000/gRate)+"s linear";

    //remove bullet after animation
    bllt.addEventListener("animationend", function(){
        //console.log("eliminando Bala "+bllt.id);
        objClear(bllt.id);
        objClear(bStyle.id);
    }); 
    //for chrome, safari, opera..
    bllt.addEventListener("webkitAnimationEnd", function(){
        //console.log("eliminando Bala "+bllt.id);
        objClear(bllt.id);
        objClear(bStyle.id);
    });
}

function zObject(){
    //set next spawn
    tSpawn=Math.random()*maxTspawn+1;
    zSpawn=setTimeout(zObject,tSpawn);

    //create object for zombie
    var zombie=document.createElement("span");
    //assign ID (ascending) used as counter
    z++;
    zombie.setAttribute("id","z"+z);

    //set zombie speed to reach the player, in seconds (random, from min to max speed)
    var zSpeed=Math.floor((Math.random()*(sMax-sMin+1))+sMin);
    zombie.setAttribute("vel",zSpeed);
    
    //set zombie level (number of cubes that make up the zombie, random from min to max level)
    var zLvl=Math.floor((Math.random()*(lMax-lMin+1))+lMin);
    zombie.setAttribute("lvl",zLvl);
    //add to game
    document.getElementById("main").appendChild(zombie);

    //reassign zombie object for edition
    zombie=document.getElementById("z"+z);
    //set physical properties (8px black square)
    zombie.style.width="8px";
    zombie.style.height="8px";
    zombie.style.backgroundColor="DarkKhaki";
    zombie.style.position="absolute";
    zombie.style.zIndex="15";
    zombie.style.opacity=0.95;

    //add zombie levels if needed
    //first, get total cubes needed for zombie level
    var lTotal=zLvl**2;
    if(zLvl>1){
        //loop for rows
        for (var i=-1;i<zLvl-1;i++){
            //loop for columns
            var j=-1;
            /*if(i==0){
                j=1;
            }*/
            for(j;j<zLvl-1;j++){
                //skip middle (head) cube
                if(i==0&&j==0){
                    continue;
                }
                var lvl=zombie.cloneNode();
                lvl.setAttribute("id","z"+z+"."+i+"."+j);
                zombie.appendChild(lvl);
                //set properties
                lvl=document.getElementById("z"+z+"."+i+"."+j);
                //move to right (offset from left origin)
                lvl.style.left=(j*8)+"px";
                //move each row
                lvl.style.top=(i*8)+"px";
                //move back
                lvl.style.zIndex="5";
            }
        }
    }
    //change zombie head color and bring to front
    zombie=document.getElementById("z"+z);
    zombie.style.backgroundColor="Maroon";
    zombie.style.boxShadow="0 0 3px LemonChiffon";
    zombie.style.width="8px";
    zombie.style.height="8px";
    zombie.style.borderRadius="8px";

	//add zombie red eyes
	//eye1
	var eye=document.createElement("span");
	eye.setAttribute("id", zombie.id+".e1");
	zombie.appendChild(eye);
	eye=document.getElementById(zombie.id+".e1");
	eye.style.position="absolute";
	eye.style.zIndex="10";
	eye.style.width="3px";
	eye.style.height="3px";
	eye.style.borderRadius="3px";
	eye.style.backgroundColor="yellow";
	eye.style.boxShadow="0 0 3px white";
	eye.style.top="6px";
	//eye2
	eye=document.createElement("span");
	eye.setAttribute("id", zombie.id+".e2");
	zombie.appendChild(eye);
	eye=document.getElementById(zombie.id+".e2");
	eye.style.position="absolute";
	eye.style.zIndex="10";
	eye.style.width="3px";
	eye.style.height="3px";
	eye.style.borderRadius="3px";
	eye.style.backgroundColor="yellow";
	eye.style.boxShadow="0 0 3px white";
	eye.style.top="6px";
	eye.style.left="5px";

    //ubicación aleatoria en los bordes (1:arriba; 2:derecha; 3:abajo; 4:izquierda)
    //la ubicación es porcentual para conservarla al redimensionar
    var b=Math.floor((Math.random() * 4) + 1);

    switch(b){
    //borde 1 (arriba)
    case 1:
        var zX=Math.random()*(w-1); //excluimos el último pixel para que no quede fuera
        var zY=0;
        zombie.style.left=zX*100/w+"%";
        zombie.style.top=zY*100/h+"%";
    break;
    //borde 2 (derecha)
    case 2:
        var zX=w-1;
        var zY=Math.random()*(h-1);
        zombie.style.left=zX*100/w+"%";
        zombie.style.top=zY*100/h+"%";
    break;
    //borde 3 (abajo)
    case 3:
        var zX=Math.random()*(w-1);
        var zY=h-1;
        zombie.style.left=zX*100/w+"%";
        zombie.style.top=zY*100/h+"%";
    break;
    //borde 4 (izquierda)
    case 4:
        var zX=0;
        var zY=Math.random()*(h-1);
        zombie.style.left=zX*100/w+"%";
        zombie.style.top=zY*100/h+"%";
    break;
    }

    //assign rotation
    var zAng=0;
    //Calculate angle in radians (arc tangent of sides from center)
    if(zX>=w/2){
        var a=zX-(w/2);
        var b=zY-(h/2);
        zAng=Math.atan((b/a)).toFixed(3);
    }else{
        var a=zX-(w/2);
        var b=zY-(h/2);
        zAng=(Math.PI+Math.atan((b/a))).toFixed(3);
    }
    zombie.style.transform="rotate("+(zAng-Math.PI*1.5)+"rad)";

    //add movement animation
    zombie.style.animation="zMove "+zSpeed+"s";
    //add animation end
    zombie.addEventListener("animationend", function(){
        zombie.style.animation="eat 0.5s infinite";
    }); 
    //for chrome, safari, opera..
    zombie.addEventListener("webkitAnimationEnd", function(){
        zombie.style.animation="eat 0.5s infinite";
    });
    //show spawned zombie attributes    
//    console.log(zombie.id+" vel: "+zombie.getAttribute("vel")+" lvl: "+zombie.getAttribute("lvl"));

	//zombie spawn message
	notify("Z spawned!");
}

//Function for collision detection
function colDetector(){
    var Zs=document.getElementById("main").children;
    var pl=document.getElementById("plyr-bdy");
    var Bs=pl.children;
    var col="";
    //loop bullet objects
    for(var b=1;b<Bs.length;b++){
        //loop zombie objects
        for(var c=1;c<Zs.length;c++){
            //loop zombie children
            for(var n=0;n<Zs[c].children.length;n++){
                col=collides(Bs[b],Zs[c].children[n]);
                if(col){
                    //console.log("COLLISION!!!");
                    //delete bullet so it doesn't hit anymore
                    Bs[b].remove();
                    //remove zombie element
                    Zs[c].children[n].remove();
                    //add Hit point
                    H++;
                    //notify hit
                    notify("Hit!");
                }
            }
            //last object
            col=collides(Bs[b],Zs[c]);
            if(col){
                //console.log("COLLISION!!!");
                //remove bullet
                Bs[b].remove();
                //remove zombie
                Zs[c].remove();
                //add kill point
                k++;
                //notify kill
                notify("Killed!");
            }
        }
    }
    //check player collision
    for(var c=1;c<Zs.length;c++){
        col=collides(pl,Zs[c]);
        if(col){
            //console.log("COLLISION!!!");
            notify("You DIED!");
            //end game by pausing
            end();
            //TO-DO: trigger final score animation
        }
    }
}

function notify(txt){
    //find notification object
    var t=document.getElementById("gameTxt");
    //remove animation
    t.classList.remove("gameTxt");
    //set displayed text
    t.innerHTML=txt;
    //restore animation
    setTimeout(function(){
        t.classList.add("gameTxt");
    },100);
}

//Function for collision detection
function collides(a, b) {
    try{
        var aRect = a.getBoundingClientRect();
        var bRect = b.getBoundingClientRect();
        return !(
            ((aRect.top + aRect.height) < (bRect.top)) ||
            (aRect.top > (bRect.top + bRect.height)) ||
            ((aRect.left + aRect.width) < bRect.left) ||
            (aRect.left > (bRect.left + bRect.width))
        );
    }catch{}
}

function stopAnimations(){
    //zombies and bullets
    var Zs=document.getElementById("main").children;
    var pl=document.getElementById("plyr-bdy");
    var Bs=pl.children;
    //clouds
    var Cl=document.getElementById("sky").children;
    //loop and pause animations
    for(var c=1;c<Zs.length;c++){
        Zs[c].style.animationPlayState="paused";
    }
    for(var b=1;b<Bs.length;b++){
        Bs[b].style.animationPlayState="paused";
    }
    for(var k=0;k<Cl.length;k++){
        var Clc=Cl[k].children;
        for(var q=0;q<Clc.length;q++){
            Clc[q].style.animationPlayState="paused";
        }
    }
    //stop gun rotation
    AngleStatus=0;
}

function restoreAnimations(){
    //zombies and bullets
    var Zs=document.getElementById("main").children;
    var pl=document.getElementById("plyr-bdy");
    var Bs=pl.children;
    //clouds
    var Cl=document.getElementById("sky").children;
    //loop and run animations
    for(var c=1;c<Zs.length;c++){
        Zs[c].style.animationPlayState="running";
    }
    for(var b=1;b<Bs.length;b++){
        Bs[b].style.animationPlayState="running";
    }
    for(var k=0;k<Cl.length;k++){
        var Clc=Cl[k].children;
        for(var q=0;q<Clc.length;q++){
            Clc[q].style.animationPlayState="running";
        }
    }
    //restore gun rotation
    AngleStatus=1;
}

function endAnimation(){
    //add movement to player and zombies
    document.getElementById("plyr-cnt").style.animation="died 0.3s 1s infinite";
    //drop gun after 1s
    setTimeout(function(){
        //remove current
        document.getElementById("plyr-gun").remove();
        //create new object
        var gun=document.createElement("span");
        //set ID
        gun.setAttribute("id","drp-gun");
        //add to map
        document.getElementById("main").appendChild(gun);
        gun=document.getElementById("drp-gun");
        gun.style.display="block";
        gun.style.position="relative";
        gun.style.zIndex="10";
        gun.style.left="51.5%";
        gun.style.top="49%";
        gun.style.width="25px";
        gun.style.height="10px";
        gun.style.borderTop="5px solid lightgrey";
        gun.style.borderLeft="5px solid saddlebrown";
        gun.style.transform="rotate(30deg)";
    },1000);
    //add 20 blood spill objects
    var bld=1;
    var bleed=setInterval(function(){
        //create object
        var spill = document.createElement("span");
        //set attribute
        spill.setAttribute("id","bld"+bld);
        //set base class
        spill.setAttribute("class","blood");
        //add to game
        document.getElementById("main").appendChild(spill);
        //get spill object
        spill=document.getElementById("bld"+bld);
        //set properties
        spill.style.display="block";
        spill.style.position="absolute";
        //location random around the center
        spill.style.left=((Math.random() * 5)+45)+"%";
        spill.style.top=((Math.random() * 5)+45)+"%";
        //size random from 5 to 25 px
        var spillsize=Math.floor((Math.random()*25)+5)+"px";
        //console.log(spillsize);
        spill.style.width=spillsize;
        spill.style.height=spillsize;
        //make it circular
        spill.style.borderRadius=spillsize;
        //bring to front
        spill.style.zIndex="5";
        //add blood animation
        spill.style.animation="blood 10s";
        //add animation end
        spill.addEventListener("animationend", function(){
            spill.style.width="100px";
            spill.style.height="100px";
            spill.style.borderRadius="100px";
        }); 
        //increase counter
        bld++;
        //clear blood creation when 20
        if(bld==20){
            clearInterval(bleed);
        }
    },500);
    // add restart text after 10s
    setTimeout(function(){
        document.getElementById("gameTxt").style.opacity="1";
        document.getElementById("gameTxt").innerHTML="<a onclick='restart()'>RESTART?</a>";
    },10000);
}

//Function to vanish zombie after animation
async function objClear(i){
    try{
        document.getElementById(i).remove();
    }catch(err){
        //do nothing
    }
}

//Function to close warning message
function clsMsg(){
    document.getElementById("message").style.display="none";
}

//Functions to show/hide menu
function toggleMenu(){
    if(document.getElementById("pauseBtn").style.visibility=="visible"){
        hideMenu();
    }else{
        showMenu();
    }
}
function showMenu(){
    document.getElementById("pauseBtn").style.visibility="visible";
    document.getElementById("rstBtn").style.visibility="visible";
    document.getElementById("exitBtn").style.visibility="visible";
	document.getElementById("optBar").classList.add("optBarFill");
}

function hideMenu(){
    document.getElementById("pauseBtn").style.visibility="hidden";
    document.getElementById("rstBtn").style.visibility="hidden";
    document.getElementById("exitBtn").style.visibility="hidden";
	document.getElementById("optBar").classList.remove("optBarFill");
}



//Function for delays (not used)
function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

</script>
</html>
